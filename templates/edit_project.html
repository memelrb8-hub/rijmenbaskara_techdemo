{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Edit Project - Rijmen & Baskara</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@500;600&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  <style>
    .add-project-form{
      max-width: 800px;
      margin: 60px auto;
      padding: 0 20px;
    }
    .form-group{
      margin-bottom: 24px;
    }
    .form-group label{
      display: block;
      font-family: var(--sans);
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 8px;
      color: var(--ink);
    }
    .form-group input[type="text"],
    .form-group textarea{
      width: 100%;
      padding: 12px;
      border: 1px solid var(--rule);
      border-radius: 4px;
      font-family: var(--sans);
      font-size: 14px;
      background: var(--bg);
      color: var(--ink);
    }
    .form-group textarea{
      resize: vertical;
      min-height: 100px;
    }
    .current-images{
      margin-bottom: 20px;
    }
    .current-images h3{
      font-family: var(--sans);
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--ink);
    }
    .current-images-grid{
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 12px;
      margin-bottom: 12px;
    }
    .current-image-item{
      position: relative;
      border: 2px solid var(--rule);
      border-radius: 4px;
      overflow: hidden;
    }
    .current-image-item img{
      width: 100%;
      height: 150px;
      object-fit: cover;
      display: block;
    }
    .file-upload-area{
      border: 2px dashed var(--rule);
      border-radius: 4px;
      padding: 40px 20px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .file-upload-area:hover{
      border-color: #4CAF50;
      background: rgba(76, 175, 80, 0.05);
    }
    .file-upload-area input[type="file"]{
      display: none;
    }
    .upload-icon{
      font-size: 48px;
      margin-bottom: 12px;
    }
    .upload-text{
      font-family: var(--sans);
      font-size: 14px;
      font-weight: 600;
      color: var(--ink);
      margin-bottom: 6px;
    }
    .upload-hint{
      font-family: var(--sans);
      font-size: 12px;
      color: var(--rule);
    }
    .preview-grid{
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 12px;
      margin-top: 20px;
    }
    .preview-item{
      position: relative;
      border: 2px solid #4CAF50;
      border-radius: 4px;
      overflow: hidden;
    }
    .preview-item img{
      width: 100%;
      height: 150px;
      object-fit: cover;
      display: block;
    }
    .preview-item .filename{
      font-size: 11px;
      padding: 6px;
      background: rgba(0,0,0,0.7);
      color: white;
      word-break: break-all;
      line-height: 1.3;
    }
    .preview-item .remove-btn{
      position: absolute;
      top: 6px;
      right: 6px;
      width: 24px;
      height: 24px;
      background: rgba(255,0,0,0.8);
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 16px;
      line-height: 24px;
      padding: 0;
    }
    .preview-item .remove-btn:hover{
      background: rgba(255,0,0,1);
    }
    .checkbox-group{
      margin-top: 12px;
    }
    .checkbox-group label{
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: normal;
      cursor: pointer;
    }
    .checkbox-group input[type="checkbox"]{
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    .btn-primary{
      padding: 12px 24px;
      background: var(--ink);
      color: var(--bg);
      border: none;
      border-radius: 4px;
      font-family: var(--sans);
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: opacity 0.2s ease;
    }
    .btn-primary:hover{
      opacity: 0.85;
    }
    .btn-secondary{
      padding: 12px 24px;
      background: transparent;
      color: var(--ink);
      border: 1px solid var(--rule);
      border-radius: 4px;
      font-family: var(--sans);
      font-weight: 600;
      font-size: 14px;
      text-decoration: none;
      display: inline-block;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .btn-secondary:hover{
      background: rgba(11,11,11,.04);
    }
    .form-actions{
      display: flex;
      gap: 12px;
      margin-top: 32px;
    }
  </style>
</head>
<body>
  <div class="page-frame">
    <div class="page">
      <header class="topbar">
        <div class="container topbar__inner">
          <div class="brand">
            <a href="{% url 'home' %}" class="brand__link">R&amp;B</a>
          </div>
          <nav class="nav">
            <a class="nav__link" href="{% admin_url 'works' %}">Works</a>
            <a class="nav__link" href="{% admin_url 'articles' %}">Article</a>
            <a class="nav__link" href="{% admin_url 'about' %}">About</a>
            <a class="nav__link" href="{% admin_url 'contact' %}">Contact</a>
            <a class="nav__link" href="{% url 'toggle_view' %}" style="color: {% if request|is_staff %}#e74c3c{% else %}#3498db{% endif %}; font-weight: 600;">
              {% if request|is_staff %}üë§ Admin{% else %}üëÅÔ∏è User{% endif %}
            </a>
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
              <span class="theme-icon">‚òÄÔ∏è</span>
            </button>
          </nav>
        </div>
      </header>

      <main class="content">
        <div class="add-project-form">
          <h1 style="font-family: var(--serif); margin-bottom: 32px;">Edit Project</h1>
          
          {% if messages %}
            {% for message in messages %}
              <div style="padding: 12px; margin-bottom: 20px; border-radius: 4px; background: {% if message.tags == 'error' %}#fee;{% else %}#efe;{% endif %}">
                {{ message }}
              </div>
            {% endfor %}
          {% endif %}

          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="form-group">
              <label for="title">Project Title*</label>
              <input type="text" id="title" name="title" required value="{{ project.title }}">
            </div>

            <div class="form-group">
              <label for="description">Description</label>
              <textarea id="description" name="description">{{ project.description }}</textarea>
            </div>

            <div class="form-group">
              <label for="category">Category*</label>
              <select id="category" name="category" required style="width: 100%; padding: 12px; border: 1px solid var(--rule); border-radius: 4px; font-family: var(--sans); font-size: 14px; background: var(--bg); color: var(--ink);">
                <option value="">Select a category...</option>
                <option value="30k" {% if project.category == '30k' %}selected{% endif %}>30k</option>
                <option value="40k" {% if project.category == '40k' %}selected{% endif %}>40k</option>
                <option value="terrain" {% if project.category == 'terrain' %}selected{% endif %}>Terrain</option>
                <option value="age-of-sigmar" {% if project.category == 'age-of-sigmar' %}selected{% endif %}>Age of Sigmar</option>
              </select>
            </div>

            <div class="form-group">
              <div class="current-images">
                <h3>Current Images ({{ project.images|length }})</h3>
                <div class="current-images-grid">
                  {% for image in project.images %}
                  <div class="current-image-item">
                    <img src="{% static 'images/' %}{{ image }}" alt="{{ image }}">
                  </div>
                  {% endfor %}
                </div>
                <div class="checkbox-group">
                  <label>
                    <input type="checkbox" name="keep_existing" value="true" checked>
                    Keep existing images
                  </label>
                </div>
              </div>
              
              <label>Add New Images (Optional)</label>
              <div class="file-upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">üìÅ</div>
                <div class="upload-text">Click to select images or drag and drop</div>
                <div class="upload-hint">Accepted: JPG, JPEG, PNG, GIF, WebP</div>
                <input type="file" id="fileInput" name="new_images" 
                       accept="image/jpeg,image/jpg,image/png,image/gif,image/webp" 
                       multiple>
              </div>
              <div id="preview" class="preview-grid"></div>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn-primary">Update Project</button>
              <a href="{% url 'works' %}" class="btn-secondary">Cancel</a>
            </div>
          </form>
        </div>
      </main>
    </div>
  </div>

  <script src="{% static 'js/theme-toggle.js' %}"></script>
  <script>
    const fileInput = document.getElementById('fileInput');
    const uploadArea = document.getElementById('uploadArea');
    const preview = document.getElementById('preview');
    let selectedFiles = [];

    fileInput.addEventListener('change', function(e) {
      handleFiles(e.target.files);
    });

    uploadArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      e.stopPropagation();
    });

    uploadArea.addEventListener('drop', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const files = e.dataTransfer.files;
      fileInput.files = files;
      handleFiles(files);
    });

    function handleFiles(files) {
      selectedFiles = Array.from(files);
      preview.innerHTML = '';
      
      selectedFiles.forEach((file, index) => {
        const reader = new FileReader();
        
        reader.onload = function(e) {
          const div = document.createElement('div');
          div.className = 'preview-item';
          div.innerHTML = `
            <button type="button" class="remove-btn" onclick="removeFile(${index})">√ó</button>
            <img src="${e.target.result}" alt="${file.name}">
            <div class="filename">${file.name}</div>
          `;
          preview.appendChild(div);
        }
        
        reader.readAsDataURL(file);
      });
    }

    function removeFile(index) {
      selectedFiles.splice(index, 1);
      const dt = new DataTransfer();
      selectedFiles.forEach(file => dt.items.add(file));
      fileInput.files = dt.files;
      handleFiles(fileInput.files);
    }
  </script>
</body>
</html>
